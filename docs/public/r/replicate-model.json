{
  "name": "replicate-model",
  "type": "registry:block",
  "title": "Replicate Model Inference",
  "description": "Run AI models on Replicate for image generation, video, and more",
  "registryDependencies": [],
  "dependencies": ["@vercel/workflow"],
  "files": [
    {
      "path": "registry/steps/replicate-model.tsx",
      "type": "registry:component",
      "content": "import { fatalError, retryableError } from '@vercel/workflow';\n\ntype ReplicateParams = {\n  model: string;\n  input: Record<string, any>;\n  webhook?: string;\n};\n\nexport async function replicateModel(params: ReplicateParams) {\n  \"use step\";\n\n  const apiKey = process.env.REPLICATE_API_TOKEN;\n\n    if (!apiKey) {\n      throw fatalError('REPLICATE_API_TOKEN is required');\n    }\n\n    // Create prediction\n    const response = await fetch('https://api.replicate.com/v1/predictions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Token ${apiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        version: params.model,\n        input: params.input,\n        webhook: params.webhook,\n      }),\n    });\n\n    if (!response.ok) {\n      throw fatalError(`Replicate API error: ${response.status}`);\n    }\n\n    const prediction = await response.json();\n\n    // Poll for completion\n    let result = prediction;\n    while (result.status === 'starting' || result.status === 'processing') {\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      const pollResponse = await fetch(\n        `https://api.replicate.com/v1/predictions/${result.id}`,\n        {\n          headers: {\n            'Authorization': `Token ${apiKey}`,\n          },\n        }\n      );\n\n      result = await pollResponse.json();\n    }\n\n    if (result.status === 'failed') {\n      throw retryableError(`Model inference failed: ${result.error}`);\n    }\n\n    return result.output;\n}\n\n",
      "target": "components/steps/replicate-model.tsx"
    }
  ]
}
